image: node:8

definitions:
  services:
    postgres:
      image: sameersbn/postgresql:latest
      environment:
        DB_USER: developer
        DB_PASS: developer
        DB_NAME: silverback_test
        DB_EXTENSION: "uuid-ossp"
pipelines:
  branches:
    develop:
      - step:
          caches:
            - node
          script: # Modify the commands below to build your repository.
            - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.5.1
            - export PATH=$HOME/.yarn/bin:$PATH
            - yarn cache dir
            - yarn
            - yarn global add ts-node typescript typings
            - yarn lint
            - yarn test
          services:
            - postgres
    master:
      - step:
          caches:
            - node
          script: # Modify the commands below to build your repository.
            - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.5.1
            - export PATH=$HOME/.yarn/bin:$PATH
            - yarn cache dir
            - yarn
            - yarn global add ts-node typescript typings
            - yarn lint
            - yarn test
          services:
            - postgres
